# 什么是数仓
面向主题的、集成的、相对稳定，反映历史变化的一个数据集合
主要是为企业决策，是查询、分析和决策的基础
## 数据域
它指的是特定行或字段可以包含的可接受值的范围， 例如在职状态，只有在职和离职等这样的信息。
## 事实表类型
- 事务
- 周期快照
- 累积快照表
## 数据治理
- 梳理业务流程，规划数据资产
- 采集数据、处理数据 
- 数据存储 安全 、质量
- 数据使用olap的 安全和隔离性
## 数据维度缓慢变化
- 直接使用新的维度值，这样会丢失之前的数据
- 添加维度列，这样可以区分变化前后的维度，方便统计分组
- 极限拉链存储 只保留变动的数据的开始时间结束时间，主要为了查询历史和当前，例如用户的地址信息变更，a-北京-2010-2013，a-南京-2013-2019等这样的，方便查看历史
## 数据分层
- ods层 原始数据层
- dwd ods层上主题的简单汇总表
- dws 数据服务层，各个主题的宽表
- ads 
- dim层 维度表 维度和事实表不是直接关联，而是级联的称为雪花型、
## 星型和雪花型
就是描述事实表和维度表的关系的模型，星型就是将各种维度数据冗余，制成大宽表， 方便快速聚合操作，但是数据冗余
雪花型在基础上对维度表规划化的层级划分，缺点事需要自己关联维度表
## 建模方式
- 范式建模从下往上，主要关注于数据的etl以及数据和实体的关系上，表没有冗余，数据分析需要关联
- 维度建模从上往下，主要关注于数据处理成事实表和维度表，面向分析，数据冗余，快速分析
# hadoop
## MR的作用
- m实现kv产出 r实现k list<v>做简化
## MR过程中的排序（减少reduce的排序压力）
 - map  环形数组内存中排序一次（快速排序），溢出到本地文件，较多的小文件再做一次排序 （归并排序）
 - reduce 阶段接受到map文件再内存中，如果内存够就内存排序一次，如果内存不够就本地再排序（ 归并排序）
  - 聚合操作的时候需要shuffle
 -输出格式 默认是文本输出格式 kv形式的
# spark
 ## reduce by key 和group by key的区别
- reduce 可以再map端进行聚合减少后续的数据量，提高性能
- groupby 是要在reduce端做处理，数据量较大
# opds 
 -percentile_approx（列，0.5）  中位值 可以使用median但是数据量有会超过限制
 - 多个计算最好在percentile_approx（列，,array(0.05,0.5,0.95)） 返回一个数组
 
  
